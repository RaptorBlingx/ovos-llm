# OVOS EnMS Voice Assistant - Docker Compose
# Full OVOS integration with messagebus and skill framework
# Headless deployment (no wake word/audio hardware)

services:
  ovos:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ovos-enms
    restart: unless-stopped
    ports:
      - "5000:5000"    # REST API Bridge
      - "8181:8181"    # OVOS Messagebus (internal, can be exposed for debugging)
    environment:
      # EnMS API (use container name since containers on same network)
      - ENMS_API_URL=${ENMS_API_URL:-http://enms-analytics:8001/api/v1}
      
      # Bridge configuration
      - OVOS_BRIDGE_PORT=5000
      - OVOS_TTS_ENABLED=${OVOS_TTS_ENABLED:-true}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      
      # OVOS configuration
      - OVOS_CONFIG_PATH=/config/ovos.conf
      - XDG_CONFIG_HOME=/config
      
    volumes:
      # Skill development - mount for hot reload (comment out in production)
      - ./enms-ovos-skill:/opt/ovos/skills/enms-ovos-skill:rw
      
      # OVOS logs
      - ovos-logs:/var/log/ovos
      
      # Supervisor logs
      - supervisor-logs:/var/log/supervisor
      
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:5000/health && curl -f http://localhost:8181/core || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 20s
      
    networks:
      - enms-network
      
    # For accessing EnMS analytics on host
    extra_hosts:
      - "host.docker.internal:host-gateway"

volumes:
  ovos-logs:
    driver: local
  supervisor-logs:
    driver: local

networks:
  enms-network:
    external: true
    name: enms-network
